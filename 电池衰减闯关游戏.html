<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µæ± è¡°å‡é—¯å…³æ¸¸æˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: 0;
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .game-content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        
        .level-info {
            background: linear-gradient(to right, #4A00E0, #8E2DE2);
            color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .level-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #FFD700;
            position: relative;
            z-index: 1;
        }
        
        .level-description {
            margin-bottom: 15px;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .progress-bar {
            flex-grow: 1;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 0 15px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #00F260, #0575E6);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
            position: relative;
        }
        
        .level-indicator {
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
        }
        
        .formula {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .chart-container {
            flex: 2;
            min-width: 300px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .chart-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255,255,255,0.05) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(255,255,255,0.05) 0%, transparent 20%);
            z-index: 0;
        }
        
        .chart-title {
            color: white;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            position: relative;
            z-index: 1;
        }
        
        .chart-wrapper {
            flex: 1;
            min-height: 300px;
            position: relative;
            z-index: 1;
        }
        
        .controls-container {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-panel {
            background: linear-gradient(to right, #3494E6, #EC6EAD);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .control-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, 
                    transparent 0%, 
                    rgba(255,255,255,0.1) 50%, 
                    transparent 100%);
            z-index: 0;
        }
        
        .slider-container {
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
        }
        
        input[type="range"] {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            border: 2px solid white;
        }
        
        .value-display {
            font-size: 1.1rem;
            color: white;
            margin-top: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .battery-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }
        
        .battery {
            width: 140px;
            height: 280px;
            border: 10px solid rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            position: relative;
            background-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 
                        inset 0 0 15px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .battery::after {
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px 5px 0 0;
        }
        
        .charge-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            transition: height 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
            border-radius: 8px;
            background: linear-gradient(to top, #00c853, #64dd17);
        }
        
        .charge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.2rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            z-index: 2;
        }
        
        .task-container {
            background: linear-gradient(to right, #FF416C, #FF4B2B);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .task-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, 
                    transparent 0%, 
                    rgba(255,255,255,0.1) 50%, 
                    transparent 100%);
            z-index: 0;
        }
        
        .task-title {
            color: white;
            font-size: 1.6rem;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .task-description {
            color: white;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
            font-size: 1.1rem;
        }
        
        .task-content {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(5px);
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .question:last-child {
            border-bottom: none;
            margin-bottom: 15px;
        }
        
        .question-text {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }
        
        .option.selected {
            background: rgba(46, 204, 113, 0.5);
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }
        
        .option.correct {
            background: rgba(46, 204, 113, 0.5);
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }
        
        .option.incorrect {
            background: rgba(231, 76, 60, 0.5);
            border-color: #e74c3c;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                transparent 0%, 
                rgba(255,255,255,0.3) 50%, 
                transparent 100%);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .btn:hover::before {
            transform: translateX(100%);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-check {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-next {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            display: none;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .feedback.correct {
            border-left: 5px solid #2ecc71;
        }
        
        .feedback.incorrect {
            border-left: 5px solid #e74c3c;
        }
        
        .game-complete {
            text-align: center;
            padding: 40px;
            background: linear-gradient to right, #4A00E0, #8E2DE2);
            border-radius: 10px;
            display: none;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .game-complete::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 30%),
                radial-gradient(circle at 70% 80%, rgba(255,255,255,0.1) 0%, transparent 30%);
            z-index: 0;
        }
        
        .game-complete h2 {
            color: #FFD700;
            font-size: 2.2rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .game-complete p {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .btn-restart {
            background: linear-gradient(to right, #FF416C, #FF4B2B);
            color: white;
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 900px) {
            .game-content {
                flex-direction: column;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .level-title {
                font-size: 1.5rem;
            }
            
            .formula {
                font-size: 1.2rem;
            }
            
            .battery {
                width: 100px;
                height: 200px;
            }
            
            .charge-text {
                font-size: 1.8rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>ç”µæ± è¡°å‡é—¯å…³æ¸¸æˆ</h1>
            <p class="subtitle">æ¢ç´¢ç”µæ± å®¹é‡ä¸å……ç”µå¾ªç¯æ¬¡æ•°çš„æ•°å­¦å…³ç³» - é«˜ä¸€å¹‚å‡½æ•°ä¸æ ¹å¼å‡½æ•°åº”ç”¨</p>
        </header>
        
        <div class="game-content">
            <div class="level-info">
                <div class="level-title">ç¬¬ <span id="current-level">1</span> å…³ï¼šè®¤è¯†å‡½æ•°</div>
                <div class="level-description" id="level-description">äº†è§£ç”µæ± è¡°å‡å‡½æ•°çš„åŸºæœ¬æ€§è´¨</div>
                <div class="progress-container">
                    <span>è¿›åº¦</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="level-indicator"><span id="completed-levels">0</span>/5</span>
                </div>
                <div class="formula">ç”µæ± å®¹é‡è¡°å‡å…¬å¼ï¼šC = 100 - kâˆšN</div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">ç”µæ± å®¹é‡è¡°å‡æ›²çº¿</div>
                <div class="chart-wrapper">
                    <canvas id="batteryChart"></canvas>
                </div>
            </div>
            
            <div class="controls-container">
                <div class="control-panel">
                    <div class="slider-container">
                        <label for="k-slider">è¡°å‡ç³»æ•° (k):</label>
                        <input type="range" id="k-slider" min="0.05" max="0.8" step="0.01" value="0.4">
                        <div class="value-display">å½“å‰å€¼: <span id="k-value">0.40</span></div>
                    </div>
                    
                    <div class="slider-container">
                        <label for="n-slider">å……ç”µå¾ªç¯æ¬¡æ•° (N):</label>
                        <input type="range" id="n-slider" min="0" max="2000" step="10" value="0">
                        <div class="value-display">å½“å‰å€¼: <span id="n-value">0</span></div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="battery-container">
                        <div class="battery">
                            <div id="charge-level" class="charge-level"></div>
                            <div id="charge-text" class="charge-text">100%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="task-container" id="task-container">
            <div class="task-title">ä»»åŠ¡1ï¼šè®¤è¯†å‡½æ•°</div>
            <div class="task-description">è§‚å¯Ÿå‡½æ•° C = 100 - kâˆšNï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</div>
            
            <div class="task-content" id="task-content">
                <div class="question">
                    <div class="question-text">1. è¿™ä¸ªå‡½æ•°ä¸­çš„å¹‚å‡½æ•°éƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçš„æŒ‡æ•°æ˜¯å¤šå°‘ï¼Ÿ</div>
                    <div class="options-container">
                        <div class="option" data-value="A">A. NÂ²ï¼ŒæŒ‡æ•°ä¸º2</div>
                        <div class="option" data-value="B">B. âˆšNï¼ŒæŒ‡æ•°ä¸º1/2</div>
                        <div class="option" data-value="C">C. Nâ»Â²ï¼ŒæŒ‡æ•°ä¸º-2</div>
                        <div class="option" data-value="D">D. NÂ³ï¼ŒæŒ‡æ•°ä¸º3</div>
                    </div>
                </div>
                
                <div class="question">
                    <div class="question-text">2. è¿™ä¸ªå‡½æ•°æ˜¯å¢å‡½æ•°è¿˜æ˜¯å‡å‡½æ•°ï¼Ÿ</div>
                    <div class="options-container">
                        <div class="option" data-value="A">A. å¢å‡½æ•°</div>
                        <div class="option" data-value="B">B. å‡å‡½æ•°</div>
                        <div class="option" data-value="C">C. å…ˆå¢åå‡</div>
                        <div class="option" data-value="D">D. å…ˆå‡åå¢</div>
                    </div>
                </div>
                
                <div class="question">
                    <div class="question-text">3. å½“Nå¢å¤§æ—¶ï¼Œå‡½æ•°å€¼çš„å˜åŒ–é€Ÿåº¦æ˜¯åŠ å¿«è¿˜æ˜¯å‡æ…¢ï¼Ÿ</div>
                    <div class="options-container">
                        <div class="option" data-value="A">A. åŠ å¿«</div>
                        <div class="option" data-value="B">B. å‡æ…¢</div>
                        <div class="option" data-value="C">C. ä¿æŒä¸å˜</div>
                        <div class="option" data-value="D">D. å…ˆåŠ å¿«åå‡æ…¢</div>
                    </div>
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn btn-check" id="check-answer">æ£€æŸ¥ç­”æ¡ˆ</button>
                <button class="btn btn-next" id="next-level">ä¸‹ä¸€å…³</button>
            </div>
            
            <div class="feedback" id="feedback"></div>
        </div>
        
        <div class="game-complete" id="game-complete">
            <h2>æ­å–œä½ å®Œæˆæ‰€æœ‰å…³å¡ï¼</h2>
            <p>ä½ å·²ç»æŒæ¡äº†ç”µæ± è¡°å‡å‡½æ•°çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼</p>
            <p>æœ€ç»ˆå¾—åˆ†: <span id="final-score">100</span>/100</p>
            <button class="btn btn-restart" id="restart-game">é‡æ–°å¼€å§‹</button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆå…³å¡æ•°æ®
        const levels = [
            {
                title: "ä»»åŠ¡1ï¼šè®¤è¯†å‡½æ•°",
                description: "äº†è§£ç”µæ± è¡°å‡å‡½æ•°çš„åŸºæœ¬æ€§è´¨",
                questions: [
                    {
                        question: "1. è¿™ä¸ªå‡½æ•°ä¸­çš„å¹‚å‡½æ•°éƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçš„æŒ‡æ•°æ˜¯å¤šå°‘ï¼Ÿ",
                        options: [
                            "A. NÂ²ï¼ŒæŒ‡æ•°ä¸º2",
                            "B. âˆšNï¼ŒæŒ‡æ•°ä¸º1/2",
                            "C. Nâ»Â²ï¼ŒæŒ‡æ•°ä¸º-2",
                            "D. NÂ³ï¼ŒæŒ‡æ•°ä¸º3"
                        ],
                        correctAnswer: "B"
                    },
                    {
                        question: "2. è¿™ä¸ªå‡½æ•°æ˜¯å¢å‡½æ•°è¿˜æ˜¯å‡å‡½æ•°ï¼Ÿ",
                        options: [
                            "A. å¢å‡½æ•°",
                            "B. å‡å‡½æ•°",
                            "C. å…ˆå¢åå‡",
                            "D. å…ˆå‡åå¢"
                        ],
                        correctAnswer: "B"
                    },
                    {
                        question: "3. å½“Nå¢å¤§æ—¶ï¼Œå‡½æ•°å€¼çš„å˜åŒ–é€Ÿåº¦æ˜¯åŠ å¿«è¿˜æ˜¯å‡æ…¢ï¼Ÿ",
                        options: [
                            "A. åŠ å¿«",
                            "B. å‡æ…¢",
                            "C. ä¿æŒä¸å˜",
                            "D. å…ˆåŠ å¿«åå‡æ…¢"
                        ],
                        correctAnswer: "B"
                    }
                ],
                k: 0.4,
                n: 0
            },
            {
                title: "ä»»åŠ¡2ï¼šè®¡ç®—ç”µæ± å®¹é‡",
                description: "ç»ƒä¹ ä½¿ç”¨å‡½æ•°è®¡ç®—ç”µæ± å®¹é‡",
                questions: [
                    {
                        question: "1. å½“k=0.5ï¼ŒN=400æ—¶ï¼Œç”µæ± å®¹é‡Cæ˜¯å¤šå°‘ï¼Ÿ",
                        answer: "90",
                        partial: ["90%"]
                    },
                    {
                        question: "2. è¦ä½¿ç”µæ± å®¹é‡é™è‡³85%ï¼Œéœ€è¦å¤šå°‘æ¬¡å……ç”µå¾ªç¯ï¼Ÿï¼ˆk=0.5ï¼‰",
                        answer: "900",
                        partial: ["900æ¬¡"]
                    }
                ],
                k: 0.5,
                n: 400
            },
            {
                title: "ä»»åŠ¡3ï¼šæ±‚è¡°å‡ç³»æ•°",
                description: "æ ¹æ®å·²çŸ¥æ•°æ®æ±‚è¡°å‡ç³»æ•°",
                questions: [
                    {
                        question: "1. æŸç”µæ± åœ¨N=625æ¬¡å……ç”µåå®¹é‡é™è‡³80%ï¼Œæ±‚kå€¼",
                        answer: "0.8",
                        partial: ["0.80"]
                    },
                    {
                        question: "2. å¦‚æœå¸Œæœ›ç”µæ± åœ¨N=1600æ¬¡æ—¶æ‰é™è‡³80%ï¼Œkå€¼åº”ä¸ºå¤šå°‘ï¼Ÿ",
                        answer: "0.5",
                        partial: ["0.50"]
                    }
                ],
                k: 0.6,
                n: 625
            },
            {
                title: "ä»»åŠ¡4ï¼šä¸ç­‰å¼åº”ç”¨",
                description: "è§£å†³ç”µæ± å¯¿å‘½çš„å®é™…é—®é¢˜",
                questions: [
                    {
                        question: "1. å‚å•†æ‰¿è¯ºç”µæ± åœ¨500æ¬¡å……ç”µå¾ªç¯å†…å®¹é‡ä¸ä½äº85%ï¼Œkåº”æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ(ç­”æ¡ˆä¿ç•™3ä½å°æ•°)",
                        answer: "kâ‰¤0.671",
                        partial: ["0.671", "å°äºç­‰äº0.671"]
                    }
                ],
                k: 0.3,
                n: 500
            },
            {
                title: "ä»»åŠ¡5ï¼šæ¯”è¾ƒä¸åŒç”µæ± ",
                description: "æ¯”è¾ƒä¸åŒè¡°å‡ç³»æ•°çš„ç”µæ± æ€§èƒ½",
                questions: [
                    {
                        question: "1. æ¯”è¾ƒk=0.3å’Œk=0.5çš„ç”µæ± åœ¨N=100æ¬¡æ—¶çš„å®¹é‡å·®ï¼ˆç­”æ¡ˆæ ¼å¼ï¼šx%ï¼‰",
                        answer: "2%",
                        partial: ["2"]
                    }
                ],
                k: 0.3,
                n: 100
            }
        ];

        // æ¸¸æˆçŠ¶æ€
        let currentLevel = 0;
        let score = 0;
        const maxScore = 100;
        const scorePerQuestion = maxScore / levels.reduce((sum, level) => sum + level.questions.length, 0);

        // DOMå…ƒç´ 
        const currentLevelEl = document.getElementById('current-level');
        const levelDescriptionEl = document.getElementById('level-description');
        const progressFillEl = document.getElementById('progress-fill');
        const completedLevelsEl = document.getElementById('completed-levels');
        const taskTitleEl = document.querySelector('.task-title');
        const taskDescriptionEl = document.querySelector('.task-description');
        const taskContentEl = document.getElementById('task-content');
        const checkAnswerBtn = document.getElementById('check-answer');
        const nextLevelBtn = document.getElementById('next-level');
        const feedbackEl = document.getElementById('feedback');
        const gameCompleteEl = document.getElementById('game-complete');
        const finalScoreEl = document.getElementById('final-score');
        const restartGameBtn = document.getElementById('restart-game');

        // å›¾è¡¨ç›¸å…³å…ƒç´ 
        const kSlider = document.getElementById('k-slider');
        const kValue = document.getElementById('k-value');
        const nSlider = document.getElementById('n-slider');
        const nValue = document.getElementById('n-value');
        const chargeLevelEl = document.getElementById('charge-level');
        const chargeTextEl = document.getElementById('charge-text');
        
        // åˆå§‹åŒ–å›¾è¡¨
        const ctx = document.getElementById('batteryChart').getContext('2d');
        let batteryChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: 21}, (_, i) => i * 100),
                datasets: [{
                    label: 'ç”µæ± å®¹é‡ç™¾åˆ†æ¯” (%)',
                    data: [],
                    borderColor: '#FFD700',
                    backgroundColor: 'rgba(255, 215, 0, 0.1)',
                    borderWidth: 3,
                    pointRadius: 4,
                    pointBackgroundColor: '#FFA500',
                    fill: true,
                    tension: 0.2
                }, {
                    label: 'å¯¿å‘½ç»ˆç‚¹ (80%)',
                    data: Array(21).fill(80),
                    borderColor: '#e74c3c',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'ç”µæ± å®¹é‡è¡°å‡æ›²çº¿ C = 100 - kâˆšN (0 â‰¤ N â‰¤ 2000)',
                        font: {
                            size: 16,
                            color: '#FFFFFF'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `å®¹é‡: ${context.parsed.y.toFixed(1)}%`;
                            }
                        }
                    },
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 12,
                                color: '#FFFFFF'
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'å……ç”µå¾ªç¯æ¬¡æ•° (N)',
                            font: {
                                size: 12,
                                weight: 'bold',
                                color: '#FFFFFF'
                            }
                        },
                        min: 0,
                        max: 2000,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            maxRotation: 0,
                            autoSkip: true,
                            maxTicksLimit: 10,
                            color: '#FFFFFF'
                        }
                    },
                    y: {
                        min: 75,
                        max: 100,
                        title: {
                            display: true,
                            text: 'å‰©ä½™å®¹é‡ (%)',
                            font: {
                                size: 12,
                                weight: 'bold',
                                color: '#FFFFFF'
                            }
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            stepSize: 5,
                            color: '#FFFFFF'
                        }
                    }
                }
            }
        });

        // è®¡ç®—ç”µæ± å®¹é‡å‡½æ•°
        function calculateCapacity(k, n) {
            return 100 - k * Math.sqrt(n);
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateChartData(k) {
            const newData = [];
            for (let n = 0; n <= 2000; n += 100) {
                newData.push({
                    x: n,
                    y: calculateCapacity(k, n)
                });
            }
            
            batteryChart.data.datasets[0].data = newData;
            
            // æ¸…é™¤ä¹‹å‰çš„æ ‡è®°ç‚¹
            while (batteryChart.data.datasets.length > 2) {
                batteryChart.data.datasets.pop();
            }
            
            batteryChart.update();
        }

        // æ›´æ–°ç”µæ± å›¾å½¢
        function updateBatteryGraphic(n, k) {
            const capacity = Math.max(0, calculateCapacity(k, n));
            const height = Math.max(0, Math.min(100, capacity));
            
            chargeLevelEl.style.height = `${height}%`;
            chargeTextEl.textContent = `${capacity.toFixed(1)}%`;
            
            // æ ¹æ®ç”µé‡æ”¹å˜é¢œè‰²
            if (capacity > 70) {
                chargeLevelEl.style.background = 'linear-gradient(to top, #00c853, #64dd17)';
            } else if (capacity > 40) {
                chargeLevelEl.style.background = 'linear-gradient(to top, #ffd600, #ffab00)';
            } else {
                chargeLevelEl.style.background = 'linear-gradient(to top, #ff3d00, #ff6d00)';
            }
        }

        // æ·»åŠ æ ‡è®°ç‚¹åˆ°å›¾è¡¨
        function addMarkerToChart(n, k) {
            const capacity = calculateCapacity(k, n);
            
            // ç¡®ä¿åªæœ‰ä¸€ä¸ªæ ‡è®°ç‚¹
            if (batteryChart.data.datasets.length > 2) {
                batteryChart.data.datasets.pop();
            }
            
            batteryChart.data.datasets.push({
                label: `å½“å‰: N=${n}, C=${capacity.toFixed(1)}%`,
                data: [{x: n, y: capacity}],
                borderColor: '#9c27b0',
                backgroundColor: '#9c27b0',
                pointRadius: 8,
                pointStyle: 'rectRot',
                showLine: false
            });
            
            batteryChart.update();
        }

        // åŠ è½½å…³å¡
        function loadLevel(levelIndex) {
            const level = levels[levelIndex];
            
            // æ›´æ–°å…³å¡ä¿¡æ¯
            currentLevelEl.textContent = levelIndex + 1;
            levelDescriptionEl.textContent = level.description;
            taskTitleEl.textContent = level.title;
            taskDescriptionEl.textContent = "è§‚å¯Ÿå‡½æ•° C = 100 - kâˆšNï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š";
            
            // æ›´æ–°è¿›åº¦æ¡
            progressFillEl.style.width = `${(levelIndex / levels.length) * 100}%`;
            completedLevelsEl.textContent = levelIndex;
            
            // è®¾ç½®æ»‘å—å€¼
            kSlider.value = level.k;
            nSlider.value = level.n;
            kValue.textContent = level.k.toFixed(2);
            nValue.textContent = level.n;
            
            // æ›´æ–°å›¾è¡¨å’Œç”µæ± æ˜¾ç¤º
            updateChartData(level.k);
            updateBatteryGraphic(level.n, level.k);
            addMarkerToChart(level.n, level.k);
            
            // æ„å»ºé—®é¢˜åˆ—è¡¨ï¼ˆç¬¬ä¸€å…³ä½¿ç”¨é€‰æ‹©é¢˜ï¼‰
            if (levelIndex === 0) {
                taskContentEl.innerHTML = '';
                level.questions.forEach((q, qIndex) => {
                    const questionEl = document.createElement('div');
                    questionEl.className = 'question';
                    questionEl.innerHTML = `
                        <div class="question-text">${q.question}</div>
                        <div class="options-container">
                            ${q.options.map((option, index) => 
                                `<div class="option" data-value="${String.fromCharCode(65 + index)}">${option}</div>`
                            ).join('')}
                        </div>
                    `;
                    taskContentEl.appendChild(questionEl);
                });
            } else {
                // å…¶ä»–å…³å¡ä¿æŒæ–‡æœ¬è¾“å…¥
                taskContentEl.innerHTML = '';
                level.questions.forEach((q, i) => {
                    const questionEl = document.createElement('p');
                    questionEl.textContent = q.question;
                    questionEl.className = 'question-text';
                    taskContentEl.appendChild(questionEl);
                    
                    const inputEl = document.createElement('input');
                    inputEl.type = 'text';
                    inputEl.className = 'answer-input';
                    inputEl.id = `answer${i}`;
                    inputEl.placeholder = 'è¯·è¾“å…¥ç­”æ¡ˆ';
                    taskContentEl.appendChild(inputEl);
                });
            }
            
            // é‡ç½®æŒ‰é’®å’Œåé¦ˆ
            nextLevelBtn.style.display = 'none';
            feedbackEl.style.display = 'none';
            checkAnswerBtn.style.display = 'block';
            
            // æ·»åŠ é€‰é¡¹é€‰æ‹©äº‹ä»¶ç›‘å¬å™¨ï¼ˆä»…ç¬¬ä¸€å…³ï¼‰
            if (levelIndex === 0) {
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.closest('.question');
                        question.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        this.classList.add('selected');
                    });
                });
            }
        }

        // æ£€æŸ¥ç­”æ¡ˆï¼ˆç¬¬ä¸€å…³ç‰¹æ®Šå¤„ç†ï¼‰
        function checkAnswers() {
            const level = levels[currentLevel];
            let allCorrect = true;
            let feedbackText = '';
            
            if (currentLevel === 0) {
                // ç¬¬ä¸€å…³é€‰æ‹©é¢˜æ£€æŸ¥
                const questions = document.querySelectorAll('.question');
                
                questions.forEach((question, qIndex) => {
                    const selectedOption = question.querySelector('.option.selected');
                    
                    if (!selectedOption) {
                        allCorrect = false;
                        feedbackText += `<p>é—®é¢˜ ${qIndex+1}: è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ</p>`;
                        return;
                    }
                    
                    const userAnswer = selectedOption.dataset.value;
                    const correctAnswer = level.questions[qIndex].correctAnswer;
                    
                    if (userAnswer === correctAnswer) {
                        selectedOption.classList.add('correct');
                        score += scorePerQuestion;
                    } else {
                        allCorrect = false;
                        selectedOption.classList.add('incorrect');
                        
                        // æ ‡è®°æ­£ç¡®ç­”æ¡ˆ
                        const options = question.querySelectorAll('.option');
                        options.forEach(opt => {
                            if (opt.dataset.value === correctAnswer) {
                                opt.classList.add('correct');
                            }
                        });
                        
                        feedbackText += `<p>é—®é¢˜ ${qIndex+1}: ä¸æ­£ç¡®ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer}</p>`;
                    }
                });
            } else {
                // å…¶ä»–å…³å¡æ–‡æœ¬è¾“å…¥æ£€æŸ¥
                level.questions.forEach((q, i) => {
                    const answerInput = document.getElementById(`answer${i}`);
                    const userAnswer = answerInput.value.trim().toLowerCase();
                    const correctAnswer = q.answer.toLowerCase();
                    
                    // æ£€æŸ¥ç­”æ¡ˆ
                    if (userAnswer === correctAnswer || 
                        (q.partial && q.partial.some(p => userAnswer.includes(p.toLowerCase())))) {
                        answerInput.style.borderColor = '#28a745';
                        score += scorePerQuestion;
                    } else {
                        answerInput.style.borderColor = '#dc3545';
                        allCorrect = false;
                        feedbackText += `<p>é—®é¢˜ ${i+1}: ä¸æ­£ç¡®ã€‚æ­£ç¡®ç­”æ¡ˆåº”è¯¥æ˜¯: ${q.answer}</p>`;
                    }
                });
            }
            
            // æ˜¾ç¤ºåé¦ˆ
            if (allCorrect) {
                feedbackEl.className = 'feedback correct';
                feedbackEl.innerHTML = '<p>ğŸ‰ğŸ‰ å…¨éƒ¨æ­£ç¡®ï¼åšå¾—å¾ˆå¥½ï¼</p>';
                nextLevelBtn.style.display = 'block';
                checkAnswerBtn.style.display = 'none';
                
                // æ·»åŠ åº†ç¥æ•ˆæœ
                const container = document.querySelector('.game-container');
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    container.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }
            } else {
                feedbackEl.className = 'feedback incorrect';
                feedbackEl.innerHTML = feedbackText;
            }
            
            feedbackEl.style.display = 'block';
        }

        // ä¸‹ä¸€å…³
        function nextLevel() {
            currentLevel++;
            
            if (currentLevel < levels.length) {
                loadLevel(currentLevel);
            } else {
                // æ¸¸æˆå®Œæˆ
                document.getElementById('task-container').style.display = 'none';
                gameCompleteEl.style.display = 'block';
                finalScoreEl.textContent = Math.round(score);
            }
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            currentLevel = 0;
            score = 0;
            document.getElementById('task-container').style.display = 'block';
            gameCompleteEl.style.display = 'none';
            loadLevel(currentLevel);
        }

        // äº‹ä»¶ç›‘å¬
        checkAnswerBtn.addEventListener('click', checkAnswers);
        nextLevelBtn.addEventListener('click', nextLevel);
        restartGameBtn.addEventListener('click', restartGame);
        
        kSlider.addEventListener('input', function() {
            const k = parseFloat(this.value);
            kValue.textContent = k.toFixed(2);
            updateChartData(k);
            updateBatteryGraphic(parseInt(nSlider.value), k);
            addMarkerToChart(parseInt(nSlider.value), k);
        });
        
        nSlider.addEventListener('input', function() {
            const n = parseInt(this.value);
            nValue.textContent = n;
            updateBatteryGraphic(n, parseFloat(kSlider.value));
            addMarkerToChart(n, parseFloat(kSlider.value));
        });

        // åˆå§‹åŒ–æ¸¸æˆ
        loadLevel(currentLevel);
        
        // æ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœ
        const confettiCSS = document.createElement('style');
        confettiCSS.textContent = `
            @keyframes confettiFall {
                0% { 
                    transform: translateY(-100px) rotate(0deg); 
                    opacity: 1;
                }
                100% { 
                    transform: translateY(100vh) rotate(360deg); 
                    opacity: 0;
                }
            }
            
            .confetti {
                position: fixed;
                top: -20px;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                animation: confettiFall 3s linear forwards;
                z-index: 1000;
            }
        `;
        document.head.appendChild(confettiCSS);
    </script>
</body>
</html>